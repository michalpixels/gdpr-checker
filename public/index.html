<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDPR Checker | WAL.sk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #e23d3d 0%, #ad3a3a 100%);
            padding: 40px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-section {
            padding: 40px;
        }

        .input-group {
            position: relative;
            margin-bottom: 30px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
            transform: translateY(-2px);
        }

        .input-group label {
            position: absolute;
            top: -24px;
            left: 15px;
            background: white;
            padding: 0 10px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .check-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .check-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .check-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .check-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .check-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #f3f3f3;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .results {
            display: none;
            padding: 40px;
            background: #f8f9fa;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* CRITICAL VIOLATIONS ALERT */
        .critical-alert {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3);
            border: 3px solid #fca5a5;
            animation: criticalPulse 2s infinite;
        }

        @keyframes criticalPulse {
            0%, 100% { box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 10px 35px rgba(220, 38, 38, 0.5), 0 0 0 5px rgba(220, 38, 38, 0.1); }
        }

        .critical-alert h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .critical-alert .icon {
            font-size: 1.8rem;
            margin-right: 12px;
            animation: shake 1s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .violation-details {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .violation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .violation-item:last-child {
            border-bottom: none;
        }

        .violation-count {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .score-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            position: relative;
            animation: scaleIn 0.8s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .score-excellent { 
            background: linear-gradient(135deg, #11998e, #38ef7d);
            box-shadow: 0 0 30px rgba(17, 153, 142, 0.4);
        }
        .score-good { 
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 0 30px rgba(240, 147, 251, 0.4);
        }
        .score-poor { 
            background: linear-gradient(135deg, #fc466b, #3f5efb);
            box-shadow: 0 0 30px rgba(252, 70, 107, 0.4);
        }
        .score-critical {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.6);
            animation: criticalScore 2s infinite;
        }

        @keyframes criticalScore {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .checks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .check-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .check-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(79, 172, 254, 0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .check-item:hover::before {
            transform: translateX(100%);
        }

        .check-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .check-item.passed { 
            border-left-color: #10b981;
            background: linear-gradient(135deg, #fff 0%, #f0fdf4 100%);
        }
        .check-item.failed { 
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fff 0%, #fef2f2 100%);
        }
        .check-item.critical {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, #fff 0%, #fef2f2 100%);
            border-left-width: 8px;
            animation: criticalGlow 3s infinite;
        }

        @keyframes criticalGlow {
            0%, 100% { box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
            50% { box-shadow: 0 8px 16px rgba(0,0,0,0.1), 0 0 20px rgba(220, 38, 38, 0.3); }
        }

        .check-item h3 {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #1f2937;
        }

        .check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            animation: bounce 0.6s ease-out;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-8px,0); }
            70% { transform: translate3d(0,-4px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        .check-icon.passed { 
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }
        .check-icon.failed { 
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
        }
        .check-icon.critical {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.4);
            animation: criticalIcon 1.5s infinite;
        }

        @keyframes criticalIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .check-details {
            font-size: 0.95rem;
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .violation-list {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }

        .violation-list h4 {
            color: #dc2626;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .violation-list ul {
            list-style: none;
            padding: 0;
        }

        .violation-list li {
            padding: 4px 0;
            font-size: 0.85rem;
            color: #7f1d1d;
            display: flex;
            align-items: center;
        }

        .violation-list li::before {
            content: '⚠️';
            margin-right: 8px;
        }

        .check-score {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .score-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .score-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
        }

        .recommendations {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .recommendations h3 {
            margin-bottom: 25px;
            font-size: 1.3rem;
            color: #1f2937;
            display: flex;
            align-items: center;
        }

        .recommendation {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            animation: slideInLeft 0.6s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .recommendation:hover {
            transform: translateX(5px);
        }

        .recommendation.critical {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid #dc2626;
            border: 2px solid #fca5a5;
        }
        .recommendation.high { 
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid #ef4444;
        }
        .recommendation.medium { 
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 4px solid #f59e0b;
        }
        .recommendation.low { 
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
        }

        .priority-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-right: 15px;
            min-width: 80px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-critical {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.4);
            animation: criticalBadge 2s infinite;
        }

        @keyframes criticalBadge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .priority-high { 
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
        }
        .priority-medium { 
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }
        .priority-low { 
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .error {
            display: none;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fecaca;
            color: #dc2626;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-weight: 500;
            animation: shake 0.6s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .success-banner {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #bbf7d0;
            color: #059669;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .loading-text {
            font-size: 1.1rem;
            color: #6b7280;
            margin-top: 10px;
        }

        .url-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .timestamp {
            font-size: 0.85rem;
            color: #9ca3af;
            text-align: center;
            margin-top: 10px;
        }

        .tracking-services {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .tracking-services h4 {
            color: #ea580c;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .service-tag {
            display: inline-block;
            background: #ea580c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin: 2px 4px 2px 0;
            font-weight: 500;
        }

        .debug-info {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #374151;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .form-section { padding: 20px; }
            .results { padding: 20px; }
            .checks-grid { grid-template-columns: 1fr; }
            .score-circle { width: 100px; height: 100px; font-size: 1.8rem; }
            .critical-alert { padding: 20px; }
            .critical-alert h3 { font-size: 1.2rem; }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .header { padding: 30px 20px; }
            .check-item { padding: 20px; }
            .recommendations { padding: 20px; }
            .violation-details { padding: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛡️ GDPR Checker</h1>
            <p style="margin-bottom: 10px !important;">Pokročilá kontrola GDPR compliance s detekciou pre-consent porušení</p>
            <p style="font-size: 15px !important;">Všetky tu uvedené dáta majú len informatívny charakter.</p> 
            <p style="font-size: 15px !important;">Pre vypracovanie GDPR auditu, nás prosím kontaktujte <a href="https://wal.sk/#contact" style="color: #ffffff !important;">prostredníctvom formulára.</a></p>
            <p style="font-size: 15px !important;">Ďakujeme za pochopenie.</p>
        </div>

        <div class="form-section">
            <div class="input-group">
                <label for="url">URL webstránky</label>
                <input type="url" id="url" placeholder="https://example.com" required>
            </div>
            <button class="check-btn" onclick="checkWebsite()">
                <span id="btnText">Skontrolovať GDPR Compliance</span>
            </button>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text" id="loadingText">Kontrolujem webstránku...</p>
        </div>

        <div class="error" id="error"></div>

        <div class="results" id="results">
            <div id="urlInfo" class="url-info"></div>
            
            <!-- Critical violations alert -->
            <div id="criticalAlert" class="critical-alert" style="display: none;">
                <h3>
                    <span class="icon">🚨</span>
                    KRITICKÉ GDPR PORUŠENIA DETEKTOVANÉ!
                </h3>
                <p>Vaša stránka nastavuje cookies a spúšťa tracking pred získaním súhlasu používateľa. Toto je závažné porušenie GDPR!</p>
                <div id="violationDetails" class="violation-details"></div>
            </div>
            
            <div class="score-display">
                <div id="scoreCircle" class="score-circle">
                    <span id="scoreValue">0%</span>
                </div>
                <h2 id="scoreText">GDPR Compliance Skóre</h2>
                <div class="timestamp" id="timestamp"></div>
            </div>

            <div class="checks-grid" id="checksGrid"></div>

            <div class="recommendations">
                <h3>📋 Odporúčania na zlepšenie</h3>
                <div id="recommendationsList"></div>
            </div>

            <div id="debugInfo" class="debug-info" style="display: none;"></div>
        </div>
    </div>

    <script>
        let currentCheck = null;

        async function checkWebsite() {
            const url = document.getElementById('url').value.trim();
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            const button = document.querySelector('.check-btn');
            const btnText = document.getElementById('btnText');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const loadingText = document.getElementById('loadingText');
            const debugInfo = document.getElementById('debugInfo');

            if (!url) {
                showError('Prosím zadajte URL webstránky');
                return;
            }

            // Validate URL format
            try {
                const urlObj = new URL(url);
                if (!['http:', 'https:'].includes(urlObj.protocol)) {
                    throw new Error('Invalid protocol');
                }
            } catch {
                showError('Neplatná URL. Použite formát: https://example.com');
                return;
            }

            // Reset UI
            hideError();
            hideResults();
            showLoading();
            
            button.disabled = true;
            btnText.textContent = 'Kontrolujem...';
            progressBar.style.display = 'block';

            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressFill.style.width = progress + '%';
            }, 600);

            // Update loading messages
            const loadingMessages = [
                'Načítavam webstránku...',
                'Monitorujem cookies pred súhlasom...',
                'Detekujem tracking služby...',
                'Hľadám cookie banner...',
                'Kontrolujem privacy policy...',
                'Analyzujem GDPR compliance...',
                'Finalizujem kontrolu...'
            ];

            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                if (messageIndex < loadingMessages.length) {
                    loadingText.textContent = loadingMessages[messageIndex];
                    messageIndex++;
                }
            }, 1200);

            try {
                console.log('Starting GDPR check for:', url);
                
                // Real API call
                const response = await fetch('/api/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });

                console.log('API Response status:', response.status);
                console.log('API Response headers:', response.headers);

                const responseText = await response.text();
                console.log('Raw response:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse JSON response:', parseError);
                    debugInfo.textContent = `Parse Error: ${parseError.message}\n\nRaw Response:\n${responseText}`;
                    debugInfo.style.display = 'block';
                    throw new Error('Server returned invalid JSON response');
                }

                console.log('Parsed result:', result);

                if (!response.ok) {
                    throw new Error(result.error || `HTTP ${response.status}: ${response.statusText}`);
                }

                // Check if result has expected structure
                if (!result || typeof result !== 'object') {
                    throw new Error('Invalid response format: expected object');
                }

                if (!result.success && !result.data) {
                    throw new Error(result.error || 'API returned unsuccessful response');
                }

                clearInterval(progressInterval);
                clearInterval(messageInterval);
                
                // Complete progress
                progressFill.style.width = '100%';
                
                setTimeout(() => {
                    hideLoading();
                    displayResults(result.data || result);
                }, 800);

            } catch (error) {
                console.error('Error during GDPR check:', error);
                clearInterval(progressInterval);
                clearInterval(messageInterval);
                hideLoading();
                showError('Chyba pri kontrole: ' + error.message);
                
                // Show debug info in case of error
                debugInfo.textContent = `Error: ${error.message}\n\nStack: ${error.stack}`;
                debugInfo.style.display = 'block';
            } finally {
                button.disabled = false;
                btnText.textContent = 'Skontrolovať GDPR Compliance';
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
            }
        }

        function displayResults(data) {
            console.log("API Result Object:", JSON.stringify(data, null, 2));
            
            const results = document.getElementById('results');
            const urlInfo = document.getElementById('urlInfo');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreValue = document.getElementById('scoreValue');
            const scoreText = document.getElementById('scoreText');
            const timestamp = document.getElementById('timestamp');
            const checksGrid = document.getElementById('checksGrid');
            const recommendationsList = document.getElementById('recommendationsList');
            const criticalAlert = document.getElementById('criticalAlert');
            const violationDetails = document.getElementById('violationDetails');

            // Set URL info
            urlInfo.innerHTML = `<strong>Kontrolovaná URL:</strong> ${data.url || 'N/A'}`;
            
            // Generate timestamp
            timestamp.textContent = `Posledná kontrola: ${new Date().toLocaleString('sk-SK')}`;

            // Calculate overall score
            const score = calculateOverallScore(data);
            scoreValue.textContent = score + '%';
            
            // Set score circle style based on score
            scoreCircle.className = 'score-circle ' + getScoreClass(score);
            scoreText.textContent = getScoreDescription(score);

            // Check for critical violations (pre-consent tracking)
            const hasCriticalViolations = checkCriticalViolations(data);
            if (hasCriticalViolations) {
                showCriticalAlert(data, violationDetails);
            } else {
                criticalAlert.style.display = 'none';
            }

            // Display individual checks
            displayChecks(data, checksGrid);

            // Generate recommendations
            generateRecommendations(data, recommendationsList);

            results.style.display = 'block';
        }

        function calculateOverallScore(data) {
            const checks = data.checks || {};
            const score = typeof data.score === 'number' ? data.score : 0;
            return score;
        }

        function calculateCookieScore(cookies) {
            if (!cookies || cookies.length === 0) return 100;
            
            let score = 100;
            cookies.forEach(cookie => {
                if (cookie.category === 'marketing' || cookie.category === 'tracking') {
                    score -= 20;
                } else if (cookie.category === 'analytics') {
                    score -= 10;
                } else if (cookie.category === 'functional') {
                    score -= 5;
                }
            });
            
            return Math.max(0, score);
        }

        function getScoreClass(score) {
            if (score >= 85) return 'score-excellent';
            if (score >= 70) return 'score-good';
            if (score >= 50) return 'score-poor';
            return 'score-critical';
        }

        function getScoreDescription(score) {
            if (score >= 85) return 'Výborná GDPR Compliance';
            if (score >= 70) return 'Dobrá GDPR Compliance';
            if (score >= 50) return 'Slabá GDPR Compliance';
            return 'Kritické problémy s GDPR';
        }

        function checkCriticalViolations(data) {
            return data.checks?.preConsentViolations?.found || false;
        }

        function showCriticalAlert(data, container) {
            const violationsData = data.checks?.preConsentViolations;
            document.getElementById('criticalAlert').style.display = 'block';

            if (!violationsData || !violationsData.violations) {
                container.innerHTML = '<p>Žiadne detaily o porušení dostupné.</p>';
                return;
            }

            const items = violationsData.violations.map(v => {
                let label = v.type === 'pre-consent-cookies' ? 'Pre-consent Cookies' : 'Tracking Requests';
                let names = '';

                if (v.type === 'pre-consent-cookies') {
                    names = v.details.map(c => c.name || '(neznámy cookie)').join(', ');
                } else if (v.type === 'tracking-requests') {
                    names = v.details.map(t => {
                        if (t.service) return t.service;
                        if (t.url) return new URL(t.url).hostname;
                        return '(neznámy tracking)';
                    }).join(', ');
                }

                return `
                    <div class="violation-item">
                        <span>${label}</span>
                        <span class="violation-count">${v.details.length}</span>
                    </div>
                    <div class="violation-list">
                        <h4>Detaily:</h4>
                        <ul>
                            ${names.split(', ').map(name => `<li>${name}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }).join('');

            container.innerHTML = items;
        }

        function displayChecks(data, container) {
            const checks = [
                {
                    title: 'Cookie Banner',
                    description: 'Kontrola prítomnosti a funkčnosti cookie banneru',
                    passed: data.checks?.cookieBanner?.found || false,
                    critical: !data.checks?.cookieBanner?.found,
                    details: data.checks?.cookieBanner?.elements?.length > 0
                        ? `Detegovaný cez ${data.checks.cookieBanner.elements.length} prvkov (napr. "${data.checks.cookieBanner.elements[0].text?.slice(0, 80)}...")`
                        : 'Cookie banner nebol detektovaný',
                    violations: []
                },
                {
                    title: 'Privacy Policy',
                    description: 'Kontrola dostupnosti privacy policy',
                    passed: data.checks?.privacyPolicy?.found || false,
                    critical: false,
                    details: data.checks?.privacyPolicy?.links?.[0]?.href || 'Privacy policy nebola nájdená',
                    violations: []
                },
                {
                    title: 'Cookie Policy',
                    description: 'Kontrola dostupnosti cookie policy',
                    passed: data.checks?.cookiePolicy?.found || false,
                    critical: false,
                    details: data.checks?.cookiePolicy?.links?.[0]?.href || 'Cookie policy nebola nájdená',
                    violations: []
                },
                {
                    title: 'Pre-consent Tracking',
                    description: 'Kontrola či sa nespúšťa tracking pred súhlasom',
                    passed: !data.checks?.preConsentViolations?.found,
                    critical: data.checks?.preConsentViolations?.found || false,
                    details: data.checks?.preConsentViolations?.found
                        ? `Detekované porušenia: ${data.checks.preConsentViolations.violations?.length || 0}`
                        : 'Žiadny pre-consent tracking detektovaný',
                    violations: data.checks?.preConsentViolations?.violations?.flatMap(v => v.details.map(d => d.name || d.url || '(neznáme)')) || []
                },
                {
                    title: 'SSL Certifikát',
                    description: 'Kontrola platnosti SSL certifikátu',
                    passed: data.checks?.ssl?.valid || false,
                    critical: false,
                    details: data.checks?.ssl?.details || 'SSL informácie nedostupné',
                    violations: []
                },
                {
                    title: 'Cookies Analýza',
                    description: 'Analýza typov a počtu cookies',
                    passed: !data.checks?.cookies?.cookies || data.checks.cookies.cookies.length <= 5,
                    critical: data.checks?.preConsentViolations?.violations?.some(v => v.type === 'pre-consent-cookies'),
                    details: data.checks?.cookies?.cookies?.length
                        ? `Nájdené ${data.checks.cookies.cookies.length} cookies`
                        : 'Neboli nájdené žiadne cookies',
                    violations: data.checks?.preConsentViolations?.violations
                        ?.find(v => v.type === 'pre-consent-cookies')?.details?.map(c => c.name) || []
                },
                {
                    title: 'Third-party Služby',
                    description: 'Kontrola externých služieb a ich GDPR compliance',
                    passed: !data.thirdPartyServices || data.thirdPartyServices.length <= 3,
                    critical: false,
                    details: data.thirdPartyServices?.length
                        ? `Detektovaných ${data.thirdPartyServices.length} externých služieb`
                        : 'Neboli detekované žiadne externé služby',
                    violations: data.thirdPartyServices?.map(s => `${s.name} — ${s.category}`) || []
                }
            ];

            container.innerHTML = checks.map(check => `
                <div class="check-item ${check.passed ? 'passed' : 'failed'} ${check.critical ? 'critical' : ''}">
                    <h3>
                        <div class="check-icon ${check.passed ? 'passed' : 'failed'} ${check.critical ? 'critical' : ''}">
                            ${check.passed ? '✓' : '✗'}
                        </div>
                        ${check.title}
                    </h3>
                    <div class="check-details">${check.description}</div>
                    <div class="check-details"><strong>Výsledok:</strong> ${check.details}</div>
                    
                    ${check.violations.length > 0 ? `
                        <div class="violation-list">
                            <h4>Zistené problémy:</h4>
                            <ul>
                                ${check.violations.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    ${check.title === 'Cookies Analýza' && data.checks?.cookies?.cookies?.length > 0 ? `
                        <div class="tracking-services">
                            <h4>Zistené cookies:</h4>
                            ${data.checks.cookies.cookies.map(cookie => `
                                <span class="service-tag">${cookie.name} (${cookie.domain})</span>
                            `).join('')}
                        </div>
                    ` : ''}

                    ${check.title === 'Third-party Služby' && data.thirdPartyServices?.length > 0 ? `
                        <div class="tracking-services">
                            <h4>Detegované služby:</h4>
                            ${data.thirdPartyServices.map(s => `
                                <span class="service-tag">${s.name} — ${s.category}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function generateRecommendations(data, container) {
            const recommendations = [];

            // Shortcuts
            const checks = data.checks || {};
            const cookies = data.cookies || [];
            const thirdPartyServices = data.thirdPartyServices || [];

            // 🔴 Critical recommendations
            if (checks.preConsentViolations?.found) {
                recommendations.push({
                    priority: 'critical',
                    title: 'Odstráňte pre-consent tracking',
                    description: 'Tracking alebo cookies sa nastavujú pred súhlasom používateľa. Toto je závažné porušenie GDPR.',
                    action: 'Upravte kód stránky tak, aby sa tracking kódy a cookies načítali až po súhlase používateľa.'
                });
            }

            if (!checks.cookieBanner?.found) {
                recommendations.push({
                    priority: 'critical',
                    title: 'Implementujte cookie banner',
                    description: 'Cookie banner je povinný pre všetky stránky používajúce non-essential cookies.',
                    action: 'Nastavte cookie banner s možnosťami akceptovať/odmietnuť a detailnými nastaveniami.'
                });
            }

            // 🔶 High priority recommendations
            if (!checks.privacyPolicy?.found) {
                recommendations.push({
                    priority: 'high',
                    title: 'Vytvorte Privacy Policy',
                    description: 'Privacy Policy je povinná pre všetky webstránky spracúvajúce osobné údaje.',
                    action: 'Napíšte kompletnú Privacy Policy pokrývajúcu všetky aspekty spracovania údajov.'
                });
            }

            if (cookies.length > 10) {
                recommendations.push({
                    priority: 'high',
                    title: 'Redukujte počet cookies',
                    description: `Vaša stránka používa ${cookies.length} cookies, čo môže byť nadmerné.`,
                    action: 'Preskúmajte nutnosť všetkých cookies a odstráňte nepotrebné.'
                });
            }

            // 🟡 Medium priority
            if (thirdPartyServices.length > 5) {
                recommendations.push({
                    priority: 'medium',
                    title: 'Znížte počet externých služieb',
                    description: `Detektovaných ${thirdPartyServices.length} externých služieb môže komplikovať compliance.`,
                    action: 'Zvážte odstránenie nepotrebných služieb a uzavrite DPA zmluvy pre zostávajúce.'
                });
            }

            if (!checks.ssl?.valid) {
                recommendations.push({
                    priority: 'medium',
                    title: 'Zabezpečte SSL certifikát',
                    description: 'Platný SSL certifikát je dôležitý pre bezpečnosť a dôveru používateľov.',
                    action: 'Nainštalujte a nakonfigurujte platný SSL certifikát.'
                });
            }

            // 🟢 Low priority (always shown)
            recommendations.push({
                priority: 'low',
                title: 'Pravidelne monitorujte compliance',
                description: 'GDPR compliance vyžaduje kontinuálne monitorovanie a aktualizácie.',
                action: 'Nastavte pravidelné kontroly GDPR compliance (mesačne/štvrťročne).'
            });

            // Render results
            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="success-banner">
                        🎉 Gratulujeme! Vaša stránka má dobrú GDPR compliance bez zásadných problémov.
                    </div>
                `;
                return;
            }

            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation ${rec.priority}">
                    <div class="priority-badge priority-${rec.priority}">
                        ${rec.priority.toUpperCase()}
                    </div>
                    <div>
                        <h4>${rec.title}</h4>
                        <p><strong>Problém:</strong> ${rec.description}</p>
                        <p><strong>Riešenie:</strong> ${rec.action}</p>
                    </div>
                </div>
            `).join('');
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showResults() {
            document.getElementById('results').style.display = 'block';
        }

        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // // Demo functionality - simulate API response for testing
        // function getDemoData(url) {
        //     return {
        //         url: url,
        //         cookieBanner: {
        //             present: Math.random() > 0.3,
        //             details: Math.random() > 0.5 ? 'Cookie banner detektovaný s možnosťami súhlasu' : 'Cookie banner chýba alebo je neúplný',
        //             violations: Math.random() > 0.7 ? ['Chýba možnosť odmietnuť cookies'] : []
        //         },
        //         privacyPolicy: {
        //             found: Math.random() > 0.2,
        //             url: Math.random() > 0.2 ? `${url}/privacy-policy` : null
        //         },
        //         preConsentTracking: {
        //             detected: Math.random() > 0.6,
        //             services: Math.random() > 0.6 ? ['Google Analytics', 'Facebook Pixel', 'Hotjar'] : []
        //         },
        //         ssl: {
        //             valid: Math.random() > 0.1,
        //             details: Math.random() > 0.1 ? 'Platný SSL certifikát' : 'SSL certifikát chýba alebo je neplatný'
        //         },
        //         cookies: Array.from({length: Math.floor(Math.random() * 15) + 1}, (_, i) => ({
        //             name: `cookie_${i + 1}`,
        //             category: ['essential', 'functional', 'analytics', 'marketing'][Math.floor(Math.random() * 4)],
        //             setBeforeConsent: Math.random() > 0.7
        //         })),
        //         thirdPartyServices: Array.from({length: Math.floor(Math.random() * 8)}, (_, i) => ({
        //             name: ['Google Analytics', 'Facebook Pixel', 'Hotjar', 'GTM', 'Intercom', 'Zendesk', 'Stripe', 'PayPal'][i],
        //             loadsBeforeConsent: Math.random() > 0.8
        //         }))
        //     };
        // }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GDPR Checker initialized');
            
            // Add enter key support for URL input
            document.getElementById('url').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkWebsite();
                }
            });

            // // If no API available, add demo button for testing
            // if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            //     const demoBtn = document.createElement('button');
            //     demoBtn.textContent = 'Demo Test';
            //     demoBtn.style.marginLeft = '10px';
            //     demoBtn.onclick = () => {
            //         const url = document.getElementById('url').value || 'https://example.com';
            //         const demoData = getDemoData(url);
            //         displayResults(demoData);
            //     };
            //     document.querySelector('.form-section').appendChild(demoBtn);
            // }
        });
    </script>
</body>
</html>